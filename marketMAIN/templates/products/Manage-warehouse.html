{% extends 'top navbar/top-navbar.html' %} {% block title %} Manage warehouse {%
endblock %} {% block content %}

<!-- TERMINADO -->

<link
  rel="stylesheet"
  type="text/css"
  href="{{ url_for('static', filename='css/products.css') }}"
/>

<div class="container-fluid mt-5">
  <!-- Agregamos la clase mt-5 para añadir margen superior -->
  <div class="row mx-2 mt-5 border border-Tertiary rounded p-0">
    <h6 class="mt-1 d-none d-sm-flex">Manage warehouse</h6>

    {% include 'top navbar/top-width-navbar.html' %}

    <div class="col-12 col-lg-9 mt-3">
      <!-- Utilizamos clases de Bootstrap para diseño responsivo y espaciado -->
      <form class="d-flex mt-3">
        <!-- Este div se expandirá para ocupar el espacio disponible -->

        <button
          type="button"
          class="btn btn-primary"
          data-bs-toggle="modal"
          data-bs-target="#createmodal"
          data-bs-whatever="@mdo"
        >
          Create
        </button>
      </form>

      <div
        class="col-md-12 mt-3 border border-Tertiary p-3 rounded flex-wrap justify-content-center align-items-start"
      >
        <div
          class="table-responsive"
          style="max-height: 500px; overflow-y: auto"
        >
          <table class="table table-bordered table-striped table-rounded mb-3">
            <thead>
              <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Amount</th>
                <th>Price</th>
                <th>dato</th>
                <th>dato</th>
                <th>dato</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody class="table-group-divider">
              {% for product in products %}
              <tr>
                <td>{{ product[0] }}</td>
                <td>{{ product[1] }}</td>
                <td>{{ product[3] }}</td>
                <td>{{ product[2] }}</td>
                <td>{{ product[4] }}</td>
                <td>{{ product[5] }}</td>
                <td>{{ product[6] }}</td>
                <td
                  class="text-center d-flex justify-content-center align-items-center"
                >
                  <button
                    type="button"
                    class="btn btn-warning mx-2"
                    data-bs-toggle="modal"
                    data-bs-target="#editproduct"
                    data-product-id="{{ product[0] }}"
                    onclick="setEditProductId('{{ product[0] }}')"
                  >
                    <span class="material-symbols-outlined">edit_square</span>
                  </button>
                  <button
                    type="button"
                    class="btn btn-danger mx-2 delete-product-btn"
                    data-bs-toggle="modal"
                    data-bs-target="#deleteproduct"
                    data-product-id="{{ product[0] }}"
                    onclick="setProductId('{{ product[0] }}')"
                  >
                    <span class="material-symbols-outlined"
                      >delete_forever</span
                    >
                  </button>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- CREAR PRODUCTOS MODAL -->
<div
  class="modal fade"
  id="createmodal"
  data-bs-backdrop="static"
  tabindex="-1"
  aria-labelledby="createmodallabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Create New Product</h5>
        <button
          type="button"
          class="btn-close custom-btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <form
          id="createproductmodal"
          action="{{ url_for('products.create_product') }}"
          method="post"
          class="needs-validation"
          novalidate
        >
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label for="marca" class="form-label">Brand:</label>
                <input
                  type="text"
                  class="form-control"
                  id="marca"
                  name="marca"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="producto" class="form-label">Name Product:</label>
                <input
                  type="text"
                  class="form-control"
                  id="producto"
                  name="producto"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="SelectUnitOfMeasure" class="form-label"
                  >Select Unit of Measure:</label
                >
                <select
                  class="form-select"
                  id="SelectUnitOfMeasure"
                  name="SelectUnitOfMeasure"
                  required
                >
                  <option value="" disabled selected>
                    Select Unit Of Measure
                  </option>
                  <option value="pieces">Pieces</option>
                  <option value="liters">Liters</option>
                  <option value="milliliters">Milliliters</option>
                  <option value="kilogram">Kilogram</option>
                  <option value="grams">Grams</option>
                  <option value="customize">Customized</option>
                </select>
              </div>
              <div class="mb-3">
                <label for="unitquantity" class="form-label"
                  >Unit Quantity:</label
                >
                <div class="input-group">
                  <input
                    type="number"
                    class="form-control"
                    id="unitquantity"
                    name="unitquantity"
                    min="1"
                    required
                    disabled
                  />
                  <span class="input-group-text" id="unitLabel"></span>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label for="company-select">Select Company:</label>
                <select
                  class="form-select"
                  id="company-select"
                  name="company_id"
                  required
                >
                  <option value="" disabled selected>Select Company</option>
                  {% for company in companies %}
                  <option value="{{ company[0] }}">{{ company[1] }}</option>
                  {% endfor %}
                </select>
              </div>
              <div class="mb-3">
                <label for="intermedary-select">Select Intermediary:</label>
                <select
                  class="form-select"
                  id="intermedary-select"
                  name="intermedary_id"
                  required
                >
                  <option value="" disabled selected>
                    Select Intermediary
                  </option>
                  {% for relation in relations %}
                  <option value="{{ relation[2] }}">
                    {{ relation[1] }} {{ relation[3] }} {{ relation[4] }} {{
                    relation[5] }}
                  </option>
                  {% endfor %}
                </select>
              </div>
              <div class="mb-3">
                <label for="cantidadInput" class="form-label">Quantity:</label>
                <input
                  type="number"
                  class="form-control"
                  id="cantidad"
                  name="cantidad"
                  min="1"
                  required
                />
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="newprecio" class="form-label">Unit Price:</label>
                  <div class="input-group">
                    <span class="input-group-text">$</span>
                    <input
                      type="number"
                      class="form-control"
                      id="precio"
                      name="precio"
                      min="1"
                      step="0.01"
                      required
                    />
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="text-end">
            <button
              type="button"
              class="btn btn-warning me-2"
              data-bs-dismiss="modal"
              onclick="limpiarModal()"
            >
              Close
            </button>
            <button
              id="submitProductSave"
              type="submit"
              class="btn btn-success"
            >
              Save Products
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!--EDITAR-PRODUCTOS MODAL-->
<div
  class="modal fade"
  id="editproduct"
  data-bs-backdrop="static"
  tabindex="-1"
  aria-labelledby="editproductlabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editproductlabel">Edit Product</h5>
        <button
          type="button"
          class="btn-close custom-btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <form
          id="editproductform"
          action="{{ url_for('products.update_product') }}"
          method="post"
          class="needs-validation"
          novalidate
        >
          <div class="row">
            <div class="col-md-6">
              <!--MARCA-PRODUCTOS-id>newmarca-->
              <div class="mb-3">
                <label for="newmarca" class="form-label">New Brand:</label>
                <input
                  type="text"
                  class="form-control"
                  id="newmarca"
                  name="newmarca"
                  required
                />
              </div>
              <!--NEW-NAME-PRODUCTOS-id>newproducto-->
              <div class="mb-3">
                <label for="newproducto" class="form-label"
                  >New Name Product:</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="newproducto"
                  name="newproducto"
                  required
                />
              </div>
              <!--SLECT-NEW-UNIT-id>EditSelectUnitOfMeasure-->
              <div class="mb-3">
                <label for="EditSelectUnitOfMeasure" class="form-label"
                  >Select Unit of Measure:</label
                >
                <select
                  class="form-select"
                  id="EditSelectUnitOfMeasure"
                  name="EditSelectUnitOfMeasure"
                  required
                >
                  <option value="" disabled selected>
                    Select Unit Of Measure
                  </option>
                  <option value="pieces">Pieces</option>
                  <option value="liters">Liters</option>
                  <option value="milliliters">Milliliters</option>
                  <option value="kilogram">Kilogram</option>
                  <option value="grams">Grams</option>
                  <option value="customize">Customized</option>
                </select>
              </div>
              <!--NEW-UNIT-QUANTITY-id>editunitquantity-->
              <div class="mb-3">
                <label for="editunitquantity" class="form-label"
                  >New Unit Quantity:</label
                >
                <div class="input-group">
                  <input
                    type="number"
                    class="form-control"
                    id="editunitquantity"
                    name="editunitquantity"
                    min="1"
                    required
                    disabled
                  />
                  <span class="input-group-text" id="editunitLabel"></span>
                </div>
              </div>
            </div>

            <div class="col-md-6">
              <!--EDITAR-COMPANIA-SELECCIONADO-id>company-new-select-->
              <div class="mb-3">
                <label for="company-new-select">Select New Company:</label>
                <select
                  class="form-select"
                  id="company-new-select"
                  name="company-new-select"
                  required
                >
                  <option value="" disabled selected>Select Company</option>
                  {% for company in companies %}
                  <option value="{{ company[0] }}">{{ company[1] }}</option>
                  {% endfor %}
                </select>
              </div>

              <!--EDITAR-INTERMEDIARIO-SELECCIONADO-id>intermedary-new-select-->
              <div class="mb-3">
                <label for="intermedary-new-select">Select Intermediary:</label>
                <select
                  class="form-select"
                  id="intermedary-new-select"
                  name="intermedary-new-select"
                  required
                >
                  <option value="" disabled selected>
                    Select Intermediary
                  </option>
                  {% for relation in relations %}
                  <option value="{{ relation[2] }}">
                    {{ relation[1] }} {{ relation[3] }} {{ relation[4] }} {{
                    relation[5] }}
                  </option>
                  {% endfor %}
                </select>
              </div>
              <!--NUEVA-CANTIDAD-id>newcantidad-->
              <div class="mb-3">
                <label for="newcantidadInput" class="form-label"
                  >New Quantity:</label
                >
                <input
                  type="number"
                  class="form-control"
                  id="newcantidadInput"
                  name="newcantidad"
                  min="1"
                  required
                />
              </div>
              <!--NUEVO-PRECIO-id>newprecio2-->
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="newprecio2" class="form-label"
                    >New Unit Price:</label
                  >
                  <div class="input-group">
                    <span class="input-group-text">$</span>
                    <input
                      type="number"
                      class="form-control"
                      id="newprecio2"
                      name="newprecio"
                      step="0.01"
                      min="1"
                      required
                    />
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="text-end">
            <button
              type="button"
              class="btn btn-warning me-2"
              data-bs-dismiss="modal"
            >
              Close
            </button>
            <input
              id="editproduct_id"
              type="hidden"
              name="editproduct_id"
              value=""
            />
            <button
              id="submitEditProductSave"
              type="submit"
              class="btn btn-success"
            >
              Save Changes
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!--ELIMINAR PRODUCTO MODAL-->
<div
  class="modal fade"
  id="deleteproduct"
  data-bs-backdrop="static"
  tabindex="-1"
  aria-labelledby="deleteproductlabel"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Delete Product</h5>
        <button
          type="button"
          class="btn-close custom-btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <div class="alert alert-warning" role="alert">
          Are you sure you want to delete this product?
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-warning" data-bs-dismiss="modal">
          Close
        </button>
        <form
          id="delete-product-form"
          action="{{ url_for('products.delete_product') }}"
          method="post"
        >
          <input
            id="product-id-input"
            type="hidden"
            name="product_id"
            value=""
          />
          <button id="delete-product-btn" type="submit" class="btn btn-danger">
            Delete Product
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Elemento oculto para almacenar los datos de 'members' -->
<div id="members-data" data-members="{{ members }}" style="display: none"></div>

<!-- <script src="{{ url_for('static', filename='js/qrScan.js') }}"></script>-->

<!--               FUNCIONALIDADES COMPARTIDAS POR MODAL                   -->

<!--CREATE MODAL SCRIPT PARA MANEJO DE COMPAÑIAS E INTERMEDIARIOS DINAMICOS-->
<script>
  // Función para filtrar intermediarios basados en la compañía seleccionada
  function filterIntermediaries() {
    // Obtener la opción seleccionada de la compañía
    var selectedOption =
      document.getElementById("company-select").options[
        document.getElementById("company-select").selectedIndex
      ];

    // Obtener el texto de la opción seleccionada (nombre de la compañía)
    var selectedCompany = selectedOption.textContent.toLowerCase().trim();

    // Obtener todas las opciones de intermediarios
    var intermediaries = document.querySelectorAll(
      "#intermedary-select option"
    );

    // Recorrer todas las opciones de intermediarios
    intermediaries.forEach(function (option) {
      // Obtener la compañía asociada con el intermediario (formato: "Compañía Nombre Apellido Apellido")
      var companyAndName = option.textContent.trim().toLowerCase();

      // Obtener solo el nombre de la compañía del intermediario
      var intermediaryCompany = companyAndName.split(" ")[0];

      // Comparar la compañía seleccionada con la compañía del intermediario
      if (intermediaryCompany !== selectedCompany) {
        // Ocultar el intermediario si no coincide con la compañía seleccionada
        option.style.display = "none";
      } else {
        // Mostrar el intermediario si coincide con la compañía seleccionada
        option.style.display = "block";
      }
    });
  }

  // Agregar un event listener para el cambio en la selección de compañía
  document
    .getElementById("company-select")
    .addEventListener("change", filterIntermediaries);

  // Filtrar las opciones de intermediarios al cargar la página
  filterIntermediaries();
</script>

<!--EDIT MODAL SCRIPT PARA MANEJO DE COMPAÑIAS E INTERMEDIARIOS DINAMICOS-->
<script>
  // Función para filtrar intermediarios basados en la compañía seleccionada
  function filterIntermediaries() {
    // Obtener la opción seleccionada de la compañía
    var selectedOption =
      document.getElementById("company-new-select").options[
        document.getElementById("company-new-select").selectedIndex
      ];

    // Obtener el texto de la opción seleccionada (nombre de la compañía)
    var selectedCompany = selectedOption.textContent.toLowerCase().trim();

    // Obtener todas las opciones de intermediarios
    var intermediaries = document.querySelectorAll(
      "#intermedary-new-select option"
    );

    // Recorrer todas las opciones de intermediarios
    intermediaries.forEach(function (option) {
      // Obtener la compañía asociada con el intermediario (formato: "Compañía Nombre Apellido Apellido")
      var companyAndName = option.textContent.trim().toLowerCase();

      // Obtener solo el nombre de la compañía del intermediario
      var intermediaryCompany = companyAndName.split(" ")[0];

      // Comparar la compañía seleccionada con la compañía del intermediario
      if (intermediaryCompany !== selectedCompany) {
        // Ocultar el intermediario si no coincide con la compañía seleccionada
        option.style.display = "none";
      } else {
        // Mostrar el intermediario si coincide con la compañía seleccionada
        option.style.display = "block";
      }
    });
  }

  // Agregar un event listener para el cambio en la selección de compañía
  document
    .getElementById("company-new-select")
    .addEventListener("change", filterIntermediaries);

  // Filtrar las opciones de intermediarios al cargar la página
  filterIntermediaries();
</script>

<!-- OBTIENE EL ID DEL PRODUCTO (NO BORRAR)-->
<script>
  //NO QUITAR, AQUI OBTENGO ID
  function setProductId(productId) {
    document.getElementById("product-id-input").value = productId;
    console.log("productId BORRAR>" + productId);
  }
  function setEditProductId(productId) {
    document.getElementById("editproduct_id").value = productId;
    console.log("productId EDITAR>" + productId);
  }
</script>

<!-- VALIDA LOS ESPACIOS INICIALES Y FINALES QUE EL USUARIO PUEDA LLEGAR A PONER, Y QUE NO PUEDA COPIAR Y PEGARSE ESPACIOS-->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    var trimDelay = 500; // Cambia este valor según el tiempo que desees en milisegundos
    var timeout = null;

    // Función para eliminar espacios en blanco de los valores de los campos de entrada
    function trimInputFields() {
      var inputFields = document.querySelectorAll("input:not([type='number'])");
      inputFields.forEach(function (input) {
        input.value = input.value.trim();
      });
    }

    // Función para reiniciar el temporizador
    function resetTrimTimer() {
      clearTimeout(timeout);
      timeout = setTimeout(trimInputFields, trimDelay);
    }

    // Función para manejar el evento de pegar y eliminar espacios en blanco
    function handlePaste(event) {
      var paste = (event.clipboardData || window.clipboardData).getData("text");
      event.preventDefault();
      var trimmedPaste = paste.trim();
      document.execCommand("insertText", false, trimmedPaste);
      resetTrimTimer();
    }

    // Agregar eventos a todos los campos de entrada que no son de tipo "number"
    var inputFields = document.querySelectorAll("input:not([type='number'])");
    inputFields.forEach(function (input) {
      input.addEventListener("input", resetTrimTimer);
      input.addEventListener("change", resetTrimTimer);
      input.addEventListener("blur", resetTrimTimer);
      input.addEventListener("paste", handlePaste);
    });
  });
</script>

<!-- LIMITA EL NÚMERO DE CARACTERES DE LAS ENTRADAS-->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    var maxCharactersText = 15; // Máximo de caracteres para campos de texto
    var maxCharactersNumber = 6; // Máximo de caracteres para campos de número

    // Función para manejar el evento de entrada y limitar la longitud de los campos de entrada
    function handleInput(event) {
      if (
        event.target.type === "text" &&
        event.target.value.length > maxCharactersText
      ) {
        event.target.value = event.target.value.substring(0, maxCharactersText); // Limita a maxCharactersText para campos de texto
      } else if (
        event.target.type === "number" &&
        event.target.value.length > maxCharactersNumber
      ) {
        event.target.value = event.target.value.substring(
          0,
          maxCharactersNumber
        ); // Limita a maxCharactersNumber para campos de número
      }
    }

    // Agregar evento de entrada a todos los campos de entrada
    var inputFields = document.querySelectorAll("input");
    inputFields.forEach(function (input) {
      input.addEventListener("input", handleInput);
    });
  });
</script>

<!-- VALIDA EL NULO INGRESO DE OPERADORES EN LOS INPUTS DE TIPO NUMERO-->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Función para prevenir caracteres no numéricos y operadores en inputs de tipo number
    function preventInvalidChars(event) {
      if (
        event.target.type === "number" &&
        (event.key === "e" ||
          event.key === "E" ||
          event.key === "-" ||
          event.key === "+" ||
          (event.key === "." &&
            !["cantidad", "newcantidadInput"].includes(event.target.id)))
      ) {
        event.preventDefault();
      }
    }

    // Agregar evento solo a los campos de entrada de tipo number
    var numberFields = document.querySelectorAll("input[type='number']");
    numberFields.forEach(function (input) {
      input.addEventListener("keydown", preventInvalidChars);
    });
  });
</script>

<!-- EVITA COPIAR Y PEGAR EN TODOS LOS INPUTS-->
<script>
  const inputs = document.querySelectorAll("input");

  inputs.forEach((input) => {
    input.addEventListener("keydown", function (event) {
      // Bloquea las teclas de acceso rápido (Ctrl+C, Ctrl+V, Ctrl+X, etc.)
      if (
        event.ctrlKey &&
        (event.key === "c" || event.key === "v" || event.key === "x")
      ) {
        event.preventDefault();
      }
    });

    input.addEventListener("paste", function (event) {
      // Bloquea el evento de pegar
      event.preventDefault();
    });

    input.addEventListener("copy", function (event) {
      // Bloquea el evento de copiar
      event.preventDefault();
    });
  });
</script>

<!-- SOLO PERMITE AGREGAR UN UNICO ESPACIO EN TODOS LOS INPUTS-->
<script>
  // Función para mantener solo un espacio entre palabras en los campos de entrada de texto
  function limitarEspacios(event) {
    // Obtener el valor actual del campo
    var valorCampo = event.target.value;
    // Reemplazar múltiples espacios por uno solo
    var valorSinEspaciosRepetidos = valorCampo.replace(/\s+/g, " ");
    // Actualizar el valor del campo con un solo espacio entre palabras
    event.target.value = valorSinEspaciosRepetidos;
  }

  // Seleccionar todos los campos de entrada de texto y textarea
  var inputspace = document.querySelectorAll(
    'input[type="text"], input[type="password"], input[type="email"], input[type="number"], textarea'
  );

  // Agregar evento de escucha para cada campo de entrada
  inputspace.forEach(function (input) {
    input.addEventListener("input", limitarEspacios);
  });
</script>

<!-- EVITA EL USO DE COMILLAS EN TODOS LOS CAMPOS-->
<script>
  // Función para eliminar comillas simples y dobles de todos los campos de entrada
  document.querySelectorAll("input").forEach(function (input) {
    input.addEventListener("input", function (event) {
      // Obtener el valor actual del campo de entrada
      var inputValue = event.target.value;
      // Eliminar comillas simples y comillas dobles del valor actual
      var cleanedValue = inputValue.replace(/['"]+/g, "");
      // Actualizar el valor del campo de entrada sin comillas simples y comillas dobles
      event.target.value = cleanedValue;
    });
  });
</script>

<!-- RESETEA LOS MODALES A UN ESTADO POR DEFECTO -->
<script>
  // Función para limpiar los campos del modal de creación de productos
  function limpiarModal() {
    // Limpia los campos del formulario
    document.getElementById("createproductmodal").reset();
  }

  // Función para limpiar los campos del modal de edición de productos
  function limpiarEditModal() {
    // Limpia los campos del formulario
    document.getElementById("editproductform").reset();
  }

  // Escuchar el evento de cierre del modal de creación de productos
  $("#createmodal").on("hidden.bs.modal", function () {
    // Llamar a la función para limpiar los campos del modal
    limpiarModal();
  });

  // Escuchar el evento de cierre del modal de edición de productos
  $("#editproduct").on("hidden.bs.modal", function () {
    // Llamar a la función para limpiar los campos del modal
    limpiarEditModal();
  });
</script>

<!-- DA FEEDBACK PARA RECOMENDAR NO PONER CANTIDAD EN 0 -->
<script>
  $(document).ready(function () {
    function validateInput(input) {
      if (input.val() == 0) {
        input.removeClass("is-valid").addClass("is-invalid");
        input
          .tooltip({
            title: "Tip: Don't enter zero quantities",
            placement: "top",
            trigger: "manual",
            customClass: "custom-tooltip", // Aquí se aplica la clase personalizada
          })
          .tooltip("show");
      } else {
        input.removeClass("is-invalid").addClass("is-valid");
        input.tooltip("dispose");
      }
    }

    $("#unitquantity, #cantidad, #precio, #editunitquantity, #newcantidadInput, #newprecio2").on("input", function () {
      validateInput($(this));
    });

    // Escucha el evento de cierre del modal
    $('.modal').on('hidden.bs.modal', function () {
      // Selecciona todos los campos de entrada que necesitas resetear
      $("#unitquantity, #cantidad, #precio, #editunitquantity, #newcantidadInput, #newprecio2")
        .each(function () {
          $(this).removeClass("is-valid is-invalid"); // Remueve las clases de validación
          $(this).tooltip("dispose"); // Destruye el tooltip
          $(this).val(''); // Opcional: Limpia el valor del campo de entrada
        });
    });
  });
</script>


<!--                FIN DE FUNCIONALIDADES COMPARTIDAS                     -->
<!---->
<!---->
<!---->
<!---->
<!--                                  CREATE MODAL VALIDACIONES                                   -->

<!-- EVITA ENVIAR EL FORMULARIO SI LOS CAMPOS ESTAN POR DEFECTO O SI CONTIENEN ALGUN ERROR CRITICO-->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    var form = document.getElementById("createproductmodal");
    var saveButton = document.getElementById("submitProductSave");
    var tooltip = new bootstrap.Tooltip(saveButton, {
      placement: "top",
      title: "Please fill in all fields.",
      trigger: "manual",
      customClass: "custom-tooltip", // Aquí se aplica la clase personalizada
    });

    function validateForm() {
      var requiredFields = form.querySelectorAll("[required]");
      var isEmpty = false;
      requiredFields.forEach(function (field) {
        if (!field.value.trim()) {
          isEmpty = true;
        }
      });
      saveButton.disabled = isEmpty;
      if (isEmpty) {
        saveButton.classList.remove("btn-success");
        saveButton.classList.add("btn-danger");
        tooltip.show();
      } else {
        saveButton.classList.remove("btn-danger");
        saveButton.classList.add("btn-success");
        tooltip.hide();
      }
    }

    form.addEventListener("submit", function (event) {
      validateForm();
      if (saveButton.disabled) {
        event.preventDefault();
      }
    });

    form.addEventListener("input", function () {
      validateForm();
    });

    $("#createmodal").on("hidden.bs.modal", function () {
      form.reset();
      saveButton.classList.remove("btn-danger");
      saveButton.classList.add("btn-success");
      saveButton.disabled = false;
      tooltip.hide();
    });

    document
      .getElementById("SelectUnitOfMeasure")
      .addEventListener("change", function () {
        var unitQuantityInput = document.getElementById("unitquantity");
        var unitLabel = document.getElementById("unitLabel");
        if (this.value) {
          unitQuantityInput.disabled = false;
          unitLabel.textContent = this.options[this.selectedIndex].text;
        } else {
          unitQuantityInput.disabled = true;
          unitQuantityInput.value = "";
          unitLabel.textContent = "";
        }
        validateForm();
      });
  });
</script>

<!-- FUNCIONALIDAD PARA EL LIST DE UNIDAD DE MEDIDA-->
<script>
  window.addEventListener("DOMContentLoaded", (event) => {
    const selectUnit = document.getElementById("SelectUnitOfMeasure");
    const unitQuantityInput = document.getElementById("unitquantity");
    const unitLabel = document.getElementById("unitLabel");

    let currentUnit = "";
    let incrementValue = 1;

    selectUnit.addEventListener("change", function () {
      const selectedOption = this.value;
      currentUnit = selectedOption;
      if (selectedOption !== "") {
        unitQuantityInput.removeAttribute("disabled");
        updateUnitLabel(selectedOption);
      } else {
        unitQuantityInput.setAttribute("disabled", "disabled");
        unitLabel.textContent = "";
      }
      updateIncrementValue(unitQuantityInput.value);
    });

    unitQuantityInput.addEventListener("input", function () {
      updateIncrementValue(this.value);
    });

    function updateUnitLabel(unit) {
      switch (unit) {
        case "pieces":
          unitLabel.textContent = "";
          break;
        case "liters":
          unitLabel.textContent = "L";
          break;
        case "milliliters":
          unitLabel.textContent = "mL";
          break;
        case "kilogram":
          unitLabel.textContent = "kg";
          break;
        case "grams":
          unitLabel.textContent = "g";
          break;
        default:
          unitLabel.textContent = "custom";
      }
    }
  });
</script>

<!--                             FIN DEL CREATE MODAL VALIDACIONES                                -->
<!---->
<!---->
<!---->
<!---->
<!--                                  EDIT MODAL VALIDACIONES                                     -->

<!-- EVITA ENVIAR EL FORMULARIO SI LOS CAMPOS ESTAN POR DEFECTO O SI CONTIENEN ALGUN ERROR CRITICO-->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    var form = document.getElementById("editproductform");
    var saveButton = document.getElementById("submitEditProductSave");
    var tooltip = new bootstrap.Tooltip(saveButton, {
      placement: "top",
      title: "Please fill in all fields.",
      trigger: "manual",
      customClass: "custom-tooltip", // Aquí se aplica la clase personalizada
    });

    function validateForm() {
      var requiredFields = form.querySelectorAll("[required]");
      var isEmpty = false;
      requiredFields.forEach(function (field) {
        if (!field.value.trim()) {
          isEmpty = true;
        }
      });
      saveButton.disabled = isEmpty;
      if (isEmpty) {
        saveButton.classList.remove("btn-success");
        saveButton.classList.add("btn-danger");
        tooltip.show();
      } else {
        saveButton.classList.remove("btn-danger");
        saveButton.classList.add("btn-success");
        tooltip.hide();
      }
    }

    form.addEventListener("submit", function (event) {
      validateForm();
      if (saveButton.disabled) {
        event.preventDefault();
      }
    });

    form.addEventListener("input", function () {
      validateForm();
    });

    $("#editproduct").on("hidden.bs.modal", function () {
      form.reset();
      saveButton.classList.remove("btn-danger");
      saveButton.classList.add("btn-success");
      saveButton.disabled = false;
      tooltip.hide();
    });

    document
      .getElementById("EditSelectUnitOfMeasure")
      .addEventListener("change", function () {
        var unitQuantityInput = document.getElementById("editunitquantity");
        var unitLabel = document.getElementById("editunitLabel");
        if (this.value) {
          unitQuantityInput.disabled = false;
          unitLabel.textContent = this.options[this.selectedIndex].text;
        } else {
          unitQuantityInput.disabled = true;
          unitQuantityInput.value = "";
          unitLabel.textContent = "";
        }
        validateForm();
      });
  });
</script>

<!-- FUNCIONALIDAD PARA EL LIST DE UNIDAD DE MEDIDA-->
<script>
  window.addEventListener("DOMContentLoaded", (event) => {
    const selectUnit = document.getElementById("EditSelectUnitOfMeasure");
    const unitQuantityInput = document.getElementById("editunitquantity");
    const unitLabel = document.getElementById("editunitLabel");

    let currentUnit = "";
    let incrementValue = 1;

    selectUnit.addEventListener("change", function () {
      const selectedOption = this.value;
      currentUnit = selectedOption;
      if (selectedOption !== "") {
        unitQuantityInput.removeAttribute("disabled");
        updateUnitLabel(selectedOption);
      } else {
        unitQuantityInput.setAttribute("disabled", "disabled");
        unitLabel.textContent = "";
      }
      updateIncrementValue(unitQuantityInput.value);
    });

    unitQuantityInput.addEventListener("input", function () {
      updateIncrementValue(this.value);
    });

    function updateUnitLabel(unit) {
      switch (unit) {
        case "pieces":
          unitLabel.textContent = "";
          break;
        case "liters":
          unitLabel.textContent = "L";
          break;
        case "milliliters":
          unitLabel.textContent = "mL";
          break;
        case "kilogram":
          unitLabel.textContent = "kg";
          break;
        case "grams":
          unitLabel.textContent = "g";
          break;
        default:
          unitLabel.textContent = "custom";
      }
    }
  });
</script>

<!--                                 FIN EDIT MODAL VALIDACIONES                                  -->

{% endblock %}
