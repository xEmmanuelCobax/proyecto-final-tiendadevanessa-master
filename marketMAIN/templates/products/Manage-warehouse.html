{% extends 'top navbar/top-navbar.html' %}
{% block title %} Manage warehouse {% endblock %}
{% block content %}
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/products.css') }}">

<script src="https://cdn.jsdelivr.net/npm/quagga/dist/quagga.min.js"></script>
<style>

</style>

<div class="container-fluid mt-5 "> <!-- Agregamos la clase mt-5 para añadir margen superior -->
  <div class="row mx-2 mt-5 border border-Tertiary rounded p-0 ">

    <h6 class="mt-1 d-none d-sm-flex">Manage warehouse</h6>

    <!--fadeIn: Hace que un elemento se desvanezca y aparezca gradualmente.
    fadeOut: Hace que un elemento se desvanezca gradualmente y desaparezca.
    bounceIn: Hace que un elemento haga un pequeño rebote al aparecer.
    bounceOut: Hace que un elemento haga un pequeño rebote al desaparecer.
    zoomIn: Hace que un elemento crezca gradualmente al aparecer.
    zoomOut: Hace que un elemento disminuya gradualmente al desaparecer.   SE CAYO EL SERVEEEEEEEEEEEEERRRRRRRRRRRRr YA
    flipInX: Hace que un elemento gire desde arriba al aparecer.
    flipOutX: Hace que un elemento gire hacia arriba al desaparecer.
    slideInLeft: Hace que un elemento se deslice desde la izquierda al aparecer.
    slideOutRight: Hace que un elemento se deslice hacia la derecha al desaparecer.-->

    <div class="col-12 col-lg-3 border border-Tertiary rounded p-0">
      <nav class="nav flex-column">
        <div class="list-group d-flex flex-column">
          <a class="list-group-button-home list-group-item list-group-item-action"
            href="{{ url_for('shortcut.shortcut') }}">Home</a>
          <a class="list-group-buttons list-group-item list-group-item-action"
            href="{{ url_for('products.warehouse') }}">warehouse</a>
          <a class="list-group-item list-group-item-action active animate__animated animate__bounceIn"
            href="{{ url_for('products.managewarehouse') }}">Manage warehouse</a>
          <a class="list-group-buttons list-group-item list-group-item-action"
            href="{{ url_for('products.managepresentation') }}">Manage Presentation</a>
          <a class="list-group-buttons list-group-item list-group-item-action "
            href="{{ url_for('products.managecompany') }}">Manage Companys</a>
        </div>
      </nav>
    </div>

    <div class="col-12 col-lg-9 mt-3"> <!-- Utilizamos clases de Bootstrap para diseño responsivo y espaciado -->
      <form class="d-flex mt-3">
        <div class="flex-grow-1"></div> <!-- Este div se expandirá para ocupar el espacio disponible -->

        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createmodal"
          data-bs-whatever="@mdo">Create
        </button>
      </form>

      <table class="table table-bordered  table-striped mt-3 mb-3">
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Quantity</th>
            <th>Price</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for product in products %}
          <tr>
            <td>{{ product[0] }}</td>
            <td>{{ product[1] }}</td>
            <td>{{ product[3] }}</td>
            <td>{{ product[2] }}</td>
            <td class="text-center d-flex justify-content-center align-items-center">
              <button type="button" class="square-btn btn-warning mx-2" data-bs-toggle="modal" data-bs-target="#editproduct"
                data-product-id="{{ product[0] }}">
                <span class="material-symbols-outlined">edit</span>
              </button>
              <button type="button" class="square-btn btn-danger mx-2 delete-product-btn" data-product-id="{{ product[0] }}"
                data-bs-toggle="modal" data-bs-target="#deleteproduct" onclick="setProductId('{{ product[0] }}')">
                <span class="material-symbols-outlined">delete</span>
              </button>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<div class="modal fade" id="createmodal" data-bs-backdrop="static" tabindex="-1" aria-labelledby="createmodallabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Create Nnew Product</h5>
        <button type="button" class="btn-close custom-btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form action="{{ url_for('products.create_product') }}" method="post" class="needs-validation" novalidate>
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <!--NOMBRE-PRODUCTOS-->
                <label for="nombre" class="form-label">Name:</label>
                <input type="text" class="form-control" id="nombre" name="nombre" required>
                <div class="invalid-feedback">Por favor ingresa un nombre.</div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label for="newprecio" class="form-label">Price:</label>
                <div class="input-group">
                  <span class="input-group-text">$</span>
                  <input type="number" class="form-control" id="newprecio" name="newprecio" step="0.01" required>
                  <div class="invalid-feedback">Please enter a valid price.</div>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label for="cantidadInput" class="form-label">Quantity:</label>
                <input type="number" class="form-control" id="cantidadInput" name="cantidad" required>
                <div class="invalid-feedback">Por favor ingresa una cantidad válida.</div>
              </div>
              
              <div class="mb-3">
                <label for="company-select">Select Company:</label>
                <select class="form-select form-select-sm" id="company-select" name="company_id" onchange="filterIntermediaries()">
                  <option value="" disabled selected>Select a company</option>
                  {% for company in members %}
                  <option value="{{ company[0] }}">{{ company[2] }}</option>
                  <!-- Assuming company[1] is the ID and company[2] is the name -->
                  {% endfor %}
                </select>
              </div>
              
              <div class="mb-3">
                <label for="intermediary-select">Select Intermediary:</label>
                <select class="form-select form-select-sm" id="intermediary-select" name="intermediary_id" disabled>
                  <option value="" disabled selected>Select an intermediary</option>
                  {% for member in members %}
                  <option value="{{ member[1] }}" data-company-id="{{ member[0] }}">{{ member[3] }} {{ member[4] }} {{ member[5] }}
                  </option>
                  {% endfor %}
                </select>
              </div>

            </div>
          </div>

          <!-- <div class="d-none">
            <div class="mb-3">

              <label for="cantidad" class="form-label">Codebars Scan Preview:</label>
            </div>

          
            <div class="container-fluid bg-light rounded py-3">
              <div class="preview-camera col-12 " id="camera"></div>
            </div>
          </div>
          
          <div class="mb-3">
            <label for="qrCodes" class="form-label mt-3">Codebar Scanned:</label>
            <select class="form-select form-select-sm" id="qrCodes" aria-label="Small select example">
              
            </select>
          </div> -->

          <div class="text-end">
            <button type="button" class="btn btn-warning me-2" data-bs-dismiss="modal"
              onclick="limpiarModal()">Close</button>
            <button type="submit" class="btn btn-success">Save Products</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="editproduct" data-bs-backdrop="static" tabindex="-1" aria-labelledby="editproductlabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editproductlabel">Edit Product</h5>
        <button type="button" class="btn-close custom-btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form action="" method="post" class="needs-validation" novalidate>
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label for="newnombre" class="form-label">New Name:</label>
                <input type="text" class="form-control" id="newnombre" name="newnombre" required>
                <div class="invalid-feedback">Please enter a name.</div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label for="newprecio2" class="form-label">Price:</label>
                <div class="input-group">
                  <span class="input-group-text">$</span>
                  <input type="number" class="form-control" id="newprecio2" name="newprecio2" step="0.01" required>
                  <div class="invalid-feedback">Please enter a valid price.</div>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label for="newcantidadInput" class="form-label">New Quantity:</label>
                <input type="number" class="form-control" id="newcantidadInput" name="newcantidadInput" required>
                <div class="invalid-feedback">Please enter a valid quantity.</div>
              </div>
              <div class="mb-3">
                <label for="newcompania" class="form-label">Company:</label>
                <select class="form-select form-select-sm" id="company-select2" name="company_id" onchange="filterIntermediaries()">
                  <option value="" disabled selected>Select a company</option>
                  {% for company in members %}
                  <option value="{{ company[0] }}">{{ company[2] }}</option>
                  <!-- Assuming company[1] is the ID and company[2] is the name -->
                  {% endfor %}
                </select>
                  
                </div>
                <div class="mb-3">
                  <label for="company-select">Select intermediary:</label>
                  <select class="form-select form-select-sm" id="intermediary-select2" name="intermediary_id">
                    {% for member in members %}
                    <option value="{{ member[0] }}">{{ member[1] ~ member[2] ~ member[3] }}</option>
                    {% endfor %}
                  </select>
                </div>   
            </div>
          </div>

          <div class="text-end">
            <button type="button" class="btn btn-warning me-2" data-bs-dismiss="modal"
              onclick="limpiarEditModal()">Close</button>
            <button type="submit" class="btn btn-success">Save Changes</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="modal fade " id="deleteproduct" data-bs-backdrop="static" tabindex="-1" aria-labelledby="deleteproductlabel">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Delete Product</h5>
        <button type="button" class="btn-close custom-btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="alert alert-warning" role="alert">
          Are you sure you want to delete this product?
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-warning" data-bs-dismiss="modal">Close</button>
        <form id="delete-product-form" action="{{ url_for('products.delete_product') }}" method="post">
          <input id="product-id-input" type="hidden" name="product_id" value="">
          <button id="delete-product-btn" type="submit" class="btn btn-danger">Delete Product</button>
        </form>
      </div>
    </div>
  </div>
</div>



<script src="{{ url_for('static', filename='js/modalCreate.js') }}"></script>

<script src="{{ url_for('static', filename='js/modalEdit.js') }}"></script>

<script src="{{ url_for('static', filename='js/qrScan.js') }}"></script>


<script>
  function setProductId(productId) {
      document.getElementById('product-id-input').value = productId;
    }
  function filterIntermediaries() {
    var companySelect = document.getElementById('company-select');
    var intermediarySelect = document.getElementById('intermediary-select');
    var selectedCompanyId = parseInt(companySelect.value); // Ensure selectedCompanyId is a number

    console.log(companySelect);
    console.log(intermediarySelect);
    console.log(selectedCompanyId);

    // Enable the intermediary select
    intermediarySelect.disabled = false;

    // Clear current options in intermediary select except the default option
    intermediarySelect.innerHTML = '<option value="" disabled selected>Select an intermediary</option>';
    console.log(intermediarySelect.innerHTML);

    // Initialize an empty array to hold the filtered results
    var filteredIntermediaries = [];
    
    // Iterate over the members and filter based on selectedCompanyId
    members.forEach(function (member) {
      if (member[0] === selectedCompanyId) {
        filteredIntermediaries.push(member);
        // Create a new option element for the intermediary select
        var option = document.createElement('option');
        option.value = member[1]; // You can adjust this if needed
        option.textContent = member.slice(2).join(' '); // Join the rest of the member details as the option text
        intermediarySelect.appendChild(option);
      }
    });

    console.log(filteredIntermediaries);
  }

</script>
{% endblock %}